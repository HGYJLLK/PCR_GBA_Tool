<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŒ‰é’®åˆ›å»ºå·¥å…·</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }

        h1 {
            color: #333;
            text-align: center;
        }

        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .screenshot-container {
            position: relative;
            display: inline-block;
            margin: 10px 0;
        }

        canvas {
            border: 2px solid #ddd;
            cursor: crosshair;
            display: block;
            max-width: 100%;
        }

        .info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
        }

        .coords {
            background: #f1f8e9;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }

        .button-code {
            background: #fff3e0;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
        }

        button {
            background: #2196F3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }

        button:hover {
            background: #1976D2;
        }

        .reset-btn {
            background: #f44336;
        }

        .reset-btn:hover {
            background: #d32f2f;
        }

        .save-btn {
            background: #4CAF50;
        }

        .save-btn:hover {
            background: #45a049;
        }

        input[type="text"] {
            margin: 10px 0;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            width: 300px;
        }

        .input-group {
            margin: 15px 0;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <h1>ğŸ¯ æŒ‰é’®åˆ›å»ºå·¥å…·</h1>

    <div class="container">
        <div class="info">
            <h3>ğŸ“– ä½¿ç”¨è¯´æ˜:</h3>
            <p>1. æˆªå›¾ä¼šè‡ªåŠ¨åŠ è½½</p>
            <p>2. åœ¨å›¾ç‰‡ä¸Š<strong>æ‹–åŠ¨é¼ æ ‡</strong>æ¡†é€‰æŒ‰é’®åŒºåŸŸ</p>
            <p>3. è¾“å…¥æŒ‰é’®åç§°(å¦‚: PHYSICAL_TEST)</p>
            <p>4. ç‚¹å‡»"ç”ŸæˆæŒ‰é’®æ•°æ®"</p>
            <p>5. å¤åˆ¶JSONæ•°æ®,ç²˜è´´åˆ°ç»ˆç«¯</p>
        </div>

        <div>
            <h3>æ¡†é€‰æŒ‰é’®åŒºåŸŸ</h3>
            <div class="screenshot-container">
                <canvas id="canvas"></canvas>
            </div>

            <div id="coords" class="coords" style="display:none;"></div>

            <div class="input-group" id="nameInput" style="display:none;">
                <label for="buttonName">æŒ‰é’®åç§° (å¤§å†™,ç”¨ä¸‹åˆ’çº¿åˆ†éš”):</label>
                <input type="text" id="buttonName" placeholder="ä¾‹å¦‚: PHYSICAL_TEST" style="text-transform: uppercase;">
            </div>

            <div id="code" class="button-code" style="display:none;"></div>

            <button onclick="resetCanvas()" class="reset-btn">é‡ç½®</button>
            <button onclick="generateButton()" class="save-btn" id="generateBtn" style="display:none;">ç”ŸæˆæŒ‰é’®æ•°æ®</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let image = null;
        let selection = { startX: 0, startY: 0, endX: 0, endY: 0, isDrawing: false };
        let selectedCoords = null;

        // é¼ æ ‡äº‹ä»¶
        canvas.addEventListener('mousedown', startSelection);
        canvas.addEventListener('mousemove', updateSelection);
        canvas.addEventListener('mouseup', endSelection);

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨åŠ è½½æˆªå›¾
        window.addEventListener('load', function () {
            const img = new Image();
            img.onload = function () {
                image = img;
                canvas.width = img.width;
                canvas.height = img.height;
                ctx.drawImage(img, 0, 0);

                const info = document.querySelector('.info');
                info.innerHTML = '<h3>âœ“ å·²è‡ªåŠ¨åŠ è½½æˆªå›¾</h3><p><strong>ç°åœ¨å¯ä»¥ç›´æ¥æ¡†é€‰æŒ‰é’®äº†!</strong></p>';
                info.style.background = '#c8e6c9';
            };
            img.onerror = function () {
                console.log('æœªæ‰¾åˆ° temp_screenshot.png');
            };
            img.src = '../temp_screenshot.png?t=' + new Date().getTime();
        });

        function startSelection(e) {
            const rect = canvas.getBoundingClientRect();
            selection.startX = e.clientX - rect.left;
            selection.startY = e.clientY - rect.top;
            selection.isDrawing = true;
        }

        function updateSelection(e) {
            if (!selection.isDrawing) return;

            const rect = canvas.getBoundingClientRect();
            selection.endX = e.clientX - rect.left;
            selection.endY = e.clientY - rect.top;

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(image, 0, 0);

            ctx.strokeStyle = '#2196F3';
            ctx.lineWidth = 3;
            ctx.strokeRect(
                selection.startX,
                selection.startY,
                selection.endX - selection.startX,
                selection.endY - selection.startY
            );

            ctx.fillStyle = 'rgba(33, 150, 243, 0.2)';
            ctx.fillRect(
                selection.startX,
                selection.startY,
                selection.endX - selection.startX,
                selection.endY - selection.startY
            );
        }

        function endSelection(e) {
            if (!selection.isDrawing) return;
            selection.isDrawing = false;

            const rect = canvas.getBoundingClientRect();
            selection.endX = e.clientX - rect.left;
            selection.endY = e.clientY - rect.top;

            const x1 = Math.min(Math.round(selection.startX), Math.round(selection.endX));
            const y1 = Math.min(Math.round(selection.startY), Math.round(selection.endY));
            const x2 = Math.max(Math.round(selection.startX), Math.round(selection.endX));
            const y2 = Math.max(Math.round(selection.startY), Math.round(selection.endY));

            selectedCoords = { x1, y1, x2, y2 };

            const coordsDiv = document.getElementById('coords');
            coordsDiv.style.display = 'block';
            coordsDiv.innerHTML = `
                <strong>âœ“ é€‰æ‹©å®Œæˆ!</strong><br><br>
                åæ ‡: (${x1}, ${y1}, ${x2}, ${y2})<br>
                å°ºå¯¸: ${x2 - x1} Ã— ${y2 - y1}
            `;

            document.getElementById('nameInput').style.display = 'block';
            document.getElementById('generateBtn').style.display = 'inline-block';
        }

        function generateButton() {
            const buttonName = document.getElementById('buttonName').value.trim().toUpperCase();
            if (!buttonName) {
                alert('è¯·è¾“å…¥æŒ‰é’®åç§°!');
                return;
            }

            if (!selectedCoords) {
                alert('è¯·å…ˆæ¡†é€‰æŒ‰é’®åŒºåŸŸ!');
                return;
            }

            const { x1, y1, x2, y2 } = selectedCoords;
            const jsonData = `{"name": "${buttonName}", "coords": [${x1}, ${y1}, ${x2}, ${y2}]}`;
            const code = `${buttonName} = Button(area=(${x1}, ${y1}, ${x2}, ${y2}), color=(100, 150, 200), button=(${x1}, ${y1}, ${x2}, ${y2}), file="./assets/train/${buttonName}.png")`;

            const codeDiv = document.getElementById('code');
            codeDiv.style.display = 'block';
            codeDiv.innerHTML = `
<strong>âœ“ æŒ‰é’®ä¿¡æ¯å·²ç”Ÿæˆ!</strong><br><br>
<strong>æ­¥éª¤ 1: å¤åˆ¶ä¸‹é¢çš„JSONæ•°æ®</strong><br>
<textarea id="jsonOutput" readonly onclick="this.select()" style="width: 100%; height: 60px; padding: 10px; font-family: monospace; font-size: 14px; margin: 10px 0; border: 2px solid #2196F3; border-radius: 4px; cursor: pointer;">${jsonData}</textarea>
<button onclick="copyJson()" style="background: #4CAF50; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin: 5px;">ç‚¹å‡»å¤åˆ¶</button>
<br><br>
<strong>æ­¥éª¤ 2: è¿”å›ç»ˆç«¯,ç²˜è´´æ•°æ®</strong><br>
Python è„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆæ‰€æœ‰æ“ä½œ<br><br>
<strong>ç”Ÿæˆçš„ä»£ç é¢„è§ˆ:</strong><br>
<div style="background: #e8f5e9; padding: 10px; margin: 10px 0; font-family: monospace; font-size: 11px; border-radius: 4px;">
${code}
</div>
            `;

            // è‡ªåŠ¨é€‰ä¸­
            setTimeout(() => {
                document.getElementById('jsonOutput').select();
            }, 100);
        }

        function copyJson() {
            const textarea = document.getElementById('jsonOutput');
            textarea.select();
            try {
                document.execCommand('copy');
                alert('âœ“ å·²å¤åˆ¶åˆ°å‰ªè´´æ¿!');
            } catch (err) {
                alert('è¯·æ‰‹åŠ¨é€‰æ‹©å¹¶å¤åˆ¶(Ctrl+C)');
            }
        }

        function resetCanvas() {
            if (image) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.drawImage(image, 0, 0);
            }
            document.getElementById('coords').style.display = 'none';
            document.getElementById('nameInput').style.display = 'none';
            document.getElementById('code').style.display = 'none';
            document.getElementById('generateBtn').style.display = 'none';
            document.getElementById('buttonName').value = '';
            selection = { startX: 0, startY: 0, endX: 0, endY: 0, isDrawing: false };
            selectedCoords = null;
        }
    </script>
</body>

</html>